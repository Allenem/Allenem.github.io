
        <html>
        <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
        <title>GitHub Markdown CSS demo</title>
        <link rel="shortcut icon" href="https://avatars3.githubusercontent.com/u/33366355?s=40&v=3">
        <link rel="stylesheet" href="https://sindresorhus.com/github-markdown-css/github-markdown.css">
        <link rel="stylesheet" href="../CSS/mycss.css">
        <style>
            @media (min-width: 768px) {
                .markdown-body {
                    box-sizing: border-box;
                    min-width: 200px;
                    max-width: 980px;
                    margin: 0 auto;
                    padding: 45px;
                }
            }
        </style>
        </head>
        <body>
        <article class="markdown-body">
          <h1 id="java-qrcode-jar-2019-04-16-">Java使用QRCode.jar生成与解析二维码 （2019-04-16）</h1>
<p>这个是我根据好几个人的代码修改而成的生成并解读二维码的java程序<br>主要由3个文件组成：   </p>
<p><strong>1.control.java</strong><br><strong>2.MyQRCodeImage.java</strong><br><strong>3.QRCode.jar</strong>   </p>
<p>主要思路就是main函数控制encode类和decode类<br>class encode生成并存储二维码图片<br>class decode解码图片并输出二维码图片信息<br>MyQRCodeImage.java是读取图片接口<br>QRCode.jar是二维码相关运算的依赖包   </p>
<p>去下面给出的地址下载QRCode.jar包，此jar包已经包括 生成与解析 。官网下载到的jar包是没有解析的。</p>
<p><a href="https://files.cnblogs.com/files/bigroc/QRCode.zip">https://files.cnblogs.com/files/bigroc/QRCode.zip</a></p>
<p>特别感谢 <a target="_blank" href="https://www.cnblogs.com/bigroc/">bigroc</a> 的文章<a target="_blank" href="http://www.cnblogs.com/bigroc/p/7496995.html">《Java使用QRCode.jar生成与解析二维码》</a>   </p>
<p>代码如下：</p>
<p><strong>control.java</strong></p>
<pre><code class="lang-java"><span class="hljs-comment">//control.java</span>
<span class="hljs-keyword">package</span> com.allenem.qrcode;

<span class="hljs-keyword">import</span> com.swetake.util.Qrcode;
<span class="hljs-keyword">import</span> jp.sourceforge.qrcode.QRCodeDecoder;

<span class="hljs-keyword">import</span> javax.imageio.ImageIO;
<span class="hljs-keyword">import</span> java.awt.*;
<span class="hljs-keyword">import</span> java.awt.image.BufferedImage;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.Random;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">control</span> {</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) {
        String data=<span class="hljs-string">"https://github.com/Allenem"</span>;
        <span class="hljs-keyword">long</span> t = System.currentTimeMillis();
        Random rand = <span class="hljs-keyword">new</span> Random(t);
        <span class="hljs-keyword">int</span> [][] r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">37</span>][<span class="hljs-number">37</span>];
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">37</span>; i++) {
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">37</span>; j++) {
                r[j][i] = rand.nextInt(<span class="hljs-number">2</span>);
            }
        }
        <span class="hljs-comment">// 生成二维码</span>
        control.encode(data, <span class="hljs-string">"qrcodeimage/qrcode.jpg"</span>);

        <span class="hljs-comment">// 解析二维码</span>
        control.decode(<span class="hljs-string">"qrcodeimage/qrcode.jpg"</span>);
    }

    <span class="hljs-comment">//生成并输出二维码</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">encode</span>(String srcValue, String qrcodePicfilePath){
        <span class="hljs-keyword">int</span> MAX_DATA_LENGTH = <span class="hljs-number">200</span>;
        <span class="hljs-keyword">byte</span>[] d = srcValue.getBytes();
        <span class="hljs-keyword">int</span> dataLength = d.length;
        <span class="hljs-keyword">int</span> imageWidth = <span class="hljs-number">189</span>;
        <span class="hljs-keyword">int</span> imageHeight = imageWidth;
        BufferedImage bi = <span class="hljs-keyword">new</span> BufferedImage(imageWidth, imageHeight,BufferedImage.TYPE_INT_RGB);<span class="hljs-comment">//缓冲区</span>
        Graphics2D g = bi.createGraphics();<span class="hljs-comment">//绘图</span>
        g.setBackground(Color.WHITE);
        g.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, imageWidth, imageHeight);
        g.setColor(Color.BLACK);
        <span class="hljs-keyword">if</span> (dataLength &gt; <span class="hljs-number">0</span> &amp;&amp; dataLength &lt;= MAX_DATA_LENGTH) {
            Qrcode qrcode = <span class="hljs-keyword">new</span> Qrcode();
            <span class="hljs-javadoc">/**
             * correction level分为
             * level L : 最大 7% 的错误能够被纠正；
             * level M : 最大 15% 的错误能够被纠正；
             * level Q : 最大 25% 的错误能够被纠正；
             * level H : 最大 30% 的错误能够被纠正；
             */</span>
            qrcode.setQrcodeErrorCorrect(<span class="hljs-string">'Q'</span>);
            qrcode.setQrcodeEncodeMode(<span class="hljs-string">'B'</span>);<span class="hljs-comment">//注意版本信息 N代表数字 、A代表 a-z,A-Z、B代表其他</span>
            qrcode.setQrcodeVersion(<span class="hljs-number">5</span>);<span class="hljs-comment">//版本号  1-40</span>
            <span class="hljs-keyword">boolean</span>[][] b = qrcode.calQrcode(d);<span class="hljs-comment">//让字符串生成二维码</span>
            <span class="hljs-keyword">int</span> qrcodeDataLen = b.length;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; qrcodeDataLen; i++) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; qrcodeDataLen; j++) {
                    <span class="hljs-keyword">if</span> (b[j][i]) {
                        g.fillRect(j * <span class="hljs-number">5</span> + <span class="hljs-number">2</span>, i * <span class="hljs-number">5</span> + <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>);<span class="hljs-comment">//2为偏移量，5,5为矩形小块宽高</span>
                        }
                }
            }
        System.out.println(<span class="hljs-string">"二维码成功生成！！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println( dataLength +<span class="hljs-string">"大于"</span>+ MAX_DATA_LENGTH);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        g.dispose();
        bi.flush();
        File f = <span class="hljs-keyword">new</span> File(qrcodePicfilePath);
        String suffix = f.getName().substring(f.getName().indexOf(<span class="hljs-string">"."</span>)+<span class="hljs-number">1</span>, f.getName().length());
        System.out.println(<span class="hljs-string">"二维码输出成功！！"</span>);
        <span class="hljs-keyword">try</span> {
            ImageIO.write(bi, suffix, f);
            } <span class="hljs-keyword">catch</span> (IOException ioe) {
                System.out.println(<span class="hljs-string">"二维码生成失败"</span> + ioe.getMessage());
            }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-comment">//解析二维码</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">decode</span>(String qrcodePicfilePath) {
        System.out.println(<span class="hljs-string">"开始解析二维码！！"</span>);

        <span class="hljs-comment">//读取二维码图像数据</span>
        File imageFile = <span class="hljs-keyword">new</span> File(qrcodePicfilePath);
        BufferedImage image = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            image = ImageIO.read(imageFile);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            System.out.println(<span class="hljs-string">"读取二维码图片失败： "</span> + e.getMessage());
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-comment">//解二维码</span>
        QRCodeDecoder decoder = <span class="hljs-keyword">new</span> QRCodeDecoder();
        String decodedData = <span class="hljs-keyword">new</span> String(decoder.decode(<span class="hljs-keyword">new</span> MyQRCodeImage(image))); <span class="hljs-comment">//MyQRCodeImage要有接口文件</span>
        System.out.println(<span class="hljs-string">"解析内容如下："</span>+decodedData);
        <span class="hljs-keyword">return</span> decodedData;
    }
}
</code></pre>
<p><strong>MyQRCodeImage.java</strong> </p>
<pre><code class="lang-java"><span class="hljs-comment">//MyQRCodeImage.java</span>
<span class="hljs-keyword">package</span> com.allenem.qrcode;

<span class="hljs-keyword">import</span> jp.sourceforge.qrcode.data.QRCodeImage;
<span class="hljs-keyword">import</span> java.awt.image.BufferedImage;
<span class="hljs-javadoc">/**
 * 实现QRCodeImage接口，
 * 设置解码的图片信息
 * 告诉codeDecoder.decode()将要解析的图片类型
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyQRCodeImage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">QRCodeImage</span>{</span>

    BufferedImage bufferedImage;

    <span class="hljs-keyword">public</span> <span class="hljs-title">MyQRCodeImage</span>(BufferedImage bufferedImage){
        <span class="hljs-keyword">this</span>.bufferedImage=bufferedImage;
    }

    <span class="hljs-comment">//宽</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getWidth</span>() {
        <span class="hljs-keyword">return</span> bufferedImage.getWidth();
    }

    <span class="hljs-comment">//高</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getHeight</span>() {
        <span class="hljs-keyword">return</span> bufferedImage.getHeight();
    }

    <span class="hljs-comment">//像素还是颜色</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPixel</span>(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> j) {
        <span class="hljs-keyword">return</span> bufferedImage.getRGB(i,j);
    }
}
</code></pre>
<p>文件框架如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7728717-78a61087542051ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="文件框架.png"></p>
<p>效果图如下：  </p>
<p><img src="https://upload-images.jianshu.io/upload_images/7728717-efbdd8a0da01b960.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="运行代码截图.png"></p>
<p>生成二维码图片如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7728717-187c433d121096de.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="qrcode.jpg"></p>

        </article>
        </body>
      </html>
    